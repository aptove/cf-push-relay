name = "push-relay"
main = "src/index.ts"
compatibility_date = "2024-12-01"
compatibility_flags = ["nodejs_compat"]

# KV Namespace Bindings
# Create with: wrangler kv namespace create DEVICE_TOKENS
# Create with: wrangler kv namespace create AUTH_TOKENS
[[kv_namespaces]]
binding = "DEVICE_TOKENS"
id = "0000000000000000000000000000000a" # Replace after: wrangler kv namespace create DEVICE_TOKENS

[[kv_namespaces]]
binding = "AUTH_TOKENS"
id = "0000000000000000000000000000000b" # Replace after: wrangler kv namespace create AUTH_TOKENS

# Cron Trigger: refresh APNs JWT + FCM OAuth2 token every 45 minutes
[triggers]
crons = ["*/45 * * * *"]

# Non-secret variables
[vars]
APNS_BUNDLE_ID = "com.aptove.app"
APNS_SANDBOX = "false"
FCM_PROJECT_ID = ""

# Secrets (set via `wrangler secret put <NAME>`):
# - APNS_PRIVATE_KEY   (contents of .p8 file)
# - APNS_KEY_ID        (10-char string from Apple Developer portal)
# - APNS_TEAM_ID       (10-char string)
# - FCM_PRIVATE_KEY    (RSA private key from service account JSON)
# - FCM_CLIENT_EMAIL   (service account email from JSON)
