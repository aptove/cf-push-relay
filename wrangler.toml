name = "push-relay"
main = "src/index.ts"
compatibility_date = "2024-12-01"
compatibility_flags = ["nodejs_compat"]

# Custom domain
routes = [
  { pattern = "push.aptove.com", custom_domain = true }
]

# KV Namespace Bindings
# Create with: wrangler kv namespace create DEVICE_TOKENS
# Create with: wrangler kv namespace create AUTH_TOKENS
[[kv_namespaces]]
binding = "DEVICE_TOKENS"
id = "2c1442e550f04735a2b6611331d32939" # Replace after: wrangler kv namespace create DEVICE_TOKENS

[[kv_namespaces]]
binding = "AUTH_TOKENS"
id = "5a4bf96432b5444a96ec478a465aba62" # Replace after: wrangler kv namespace create AUTH_TOKENS

# Cron Trigger: refresh APNs JWT + FCM OAuth2 token every 45 minutes
[triggers]
crons = ["*/45 * * * *"]

# Non-secret variables
[vars]
APNS_BUNDLE_ID = "com.aptove.ios"
APNS_SANDBOX = "true"  # Use "true" for debug builds, "false" for production/TestFlight
FCM_PROJECT_ID = ""

# Secrets (set via `wrangler secret put <NAME>`):
# - APNS_PRIVATE_KEY   (contents of .p8 file)
# - APNS_KEY_ID        (10-char string from Apple Developer portal)
# - APNS_TEAM_ID       (10-char string)
# - FCM_PRIVATE_KEY    (RSA private key from service account JSON)
# - FCM_CLIENT_EMAIL   (service account email from JSON)
